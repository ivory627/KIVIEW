<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">
	<resultMap type="noticeVo" id="noticeMap">
		<result property="notice_no" column="NOTICE_NO" />
		<result property="cat_detail" column="CAT_DETAIL" />
		<result property="notice_title" column="NOTICE_TITLE" />
		<result property="notice_content" column="NOTICE_CONTENT" />
		<result property="notice_writer" column="NOTICE_WRITER" />
		<result property="notice_date" column="NOTICE_DATE" />
		<result property="notice_hit" column="NOTICE_HIT" />
	</resultMap>
	
	<select id="noticeList" resultMap="noticeMap" parameterType="Criteria" >
		SELECT *
		FROM (
		SELECT N.*, 
		ROW_NUMBER() OVER(ORDER BY NOTICE_NO DESC) AS RNUM
		FROM NOTICE N
		<include refid="searchCondition"/>
		) NOTICE
		WHERE 
		RNUM BETWEEN #{rowStart} AND #{rowEnd} 
		ORDER BY NOTICE_NO DESC, NOTICE_DATE DESC
	</select>	
	
	<sql id = "searchCondition">
		<if test = "keyword != null and keyword != ''">	
			<if test="searchType == 'all'.toString()">
				WHERE (NOTICE_TITLE LIKE '%' || #{keyword} || '%')
				OR (NOTICE_CONTENT LIKE '%' ||  #{keyword} || '%')
				OR (NOTICE_WRITER LIKE '%' || #{keyword} || '%')
			</if>
			<if test = "searchType == 't'.toString()">
				WHERE NOTICE_TITLE LIKE '%' || #{keyword} || '%'
			</if>
			<if test="searchType == 'con'.toString()">
				WHERE NOTICE_CONTENT LIKE '%' || #{keyword} || '%'
			</if>
			<if test = "searchType == 'tc'.toString()">
				WHERE (NOTICE_TITLE LIKE '%' || #{keyword} || '%')
				OR (NOTICE_CONTENT LIKE '%' || #{keyword} || '%')
			</if>
			<if test = "searchType == 'cw'.toString()">
				WHERE (NOTICE_CONTENT LIKE '%' ||  #{keyword} || '%')
				OR (NOTICE_WRITER LIKE '%' || #{keyword} || '%')
			</if>
		</if>
	</sql>
	
	<select id="listCount" resultType="int" parameterType="Criteria">
		SELECT COUNT(*) FROM 
		NOTICE <include refid="searchCondition"/>
	</select>
	
	<select id="noticeDetail" parameterType="int"
		resultType="noticeVo">
		SELECT * FROM NOTICE
		WHERE NOTICE_NO = #{notice_no}
	</select>
	
	<insert id="noticeInsert" parameterType="noticeVo">
		INSERT INTO NOTICE VALUES
		(NOTICE_SEQ.NEXTVAL, #{cat_detail}, #{notice_title}, #{notice_content}, #{notice_writer},
		TO_DATE(SYSDATE,'YY/MM/DD'), 0)
	</insert>
	
	<update id="noticeUpdate" parameterType="noticeVo">
		UPDATE NOTICE SET CAT_DETAIL = #{cat_detail}, NOTICE_TITLE =
		#{notice_title},
		NOTICE_CONTENT = #{notice_content} WHERE NOTICE_NO = #{notice_no}
	</update>
	
	<delete id="noticeDelete" parameterType="int">
		DELETE FROM NOTICE WHERE NOTICE_NO = #{notice_no}
	</delete>
	
	<update id="hitupdate" parameterType="int">
		UPDATE NOTICE SET NOTICE_HIT = NOTICE_HIT+1 WHERE NOTICE_NO = #{notice_no}
	</update>
	
	<update id="hitupdateminus" parameterType="int">
		UPDATE NOTICE SET NOTICE_HIT = NOTICE_HIT-2 WHERE NOTICE_NO = #{notice_no}
	</update>


</mapper>